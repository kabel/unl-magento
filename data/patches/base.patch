Index: js/mage/adminhtml/sales/packaging.js
===================================================================
--- js/mage/adminhtml/sales/packaging.js	(revision 155730)
+++ js/mage/adminhtml/sales/packaging.js	(working copy)
@@ -584,7 +584,7 @@
             option = document.createElement('OPTION');
             option.value = '';
             option.text = '';
-            packageSize[0].options.add(option);
+            packageSize[0].add(option);
             packageSize[0].value = '';
             packageSize[0].disable();
             packageSize[0].addClassName('disabled');
Index: js/mage/adminhtml/wysiwyg/tiny_mce/setup.js
===================================================================
--- js/mage/adminhtml/wysiwyg/tiny_mce/setup.js	(revision 155730)
+++ js/mage/adminhtml/wysiwyg/tiny_mce/setup.js	(working copy)
@@ -164,6 +164,18 @@
         if (this.config.height) {
             settings.height = this.config.height;
         }
+        
+        if (this.config.extended_valid_elements) {
+        	settings.extended_valid_elements = this.config.extended_valid_elements;
+        }
+        
+        if (this.config.body_id) {
+        	settings.body_id = this.config.body_id;
+        }
+        
+        if (this.config.body_class) {
+        	settings.body_class = this.config.body_class;
+        }
 
         return settings;
     },
Index: js/mage/adminhtml/form.js
===================================================================
--- js/mage/adminhtml/form.js	(revision 155730)
+++ js/mage/adminhtml/form.js	(working copy)
@@ -438,9 +438,9 @@
             this.selected = false;
         }
 
-        if (select.options.add) {
-            select.options.add(option);
-        } else {
+        try {
+            select.add(option);
+        } catch (ex) {
             select.appendChild(option);
         }
     }
Index: lib/Varien/Image/Adapter/Abstract.php
===================================================================
--- lib/Varien/Image/Adapter/Abstract.php	(revision 155730)
+++ lib/Varien/Image/Adapter/Abstract.php	(working copy)
@@ -81,13 +81,11 @@
 
     public function getMimeType()
     {
-        if( $this->_fileType ) {
-            return $this->_fileType;
-        } else {
+        if( $this->_fileType === null ) {
             list($this->_imageSrcWidth, $this->_imageSrcHeight, $this->_fileType, ) = getimagesize($this->_fileName);
             $this->_fileMimeType = image_type_to_mime_type($this->_fileType);
-            return $this->_fileMimeType;
         }
+        return $this->_fileMimeType;
     }
 
     /**
Index: .htaccess
===================================================================
--- .htaccess	(revision 155730)
+++ .htaccess	(working copy)
@@ -26,6 +26,12 @@
 
     DirectoryIndex index.php
 
+############################################
+## UNL WDN Font types
+    AddType font/x-woff .woff
+    AddType image/svg+xml .svg
+    AddType application/vnd.ms-fontobject .eot
+
 <IfModule mod_php5.c>
 
 ############################################
@@ -34,6 +40,10 @@
 #    php_value memory_limit 64M
     php_value memory_limit 256M
     php_value max_execution_time 18000
+    php_value max_input_time 9000
+    php_value upload_max_filesize 700M
+    php_value post_max_size 700M
+    php_value auto_detect_line_endings 1
 
 ############################################
 ## disable magic quotes for php request vars
@@ -80,22 +90,22 @@
     # Insert filter on all content
     ###SetOutputFilter DEFLATE
     # Insert filter on selected content types only
-    #AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
+    #AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript
 
     # Netscape 4.x has some problems...
-    #BrowserMatch ^Mozilla/4 gzip-only-text/html
+    BrowserMatch ^Mozilla/4 gzip-only-text/html
 
     # Netscape 4.06-4.08 have some more problems
-    #BrowserMatch ^Mozilla/4\.0[678] no-gzip
+    BrowserMatch ^Mozilla/4\.0[678] no-gzip
 
     # MSIE masquerades as Netscape, but it is fine
-    #BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
+    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
 
     # Don't compress images
-    #SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
+    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
 
     # Make sure proxies don't deliver the wrong content
-    #Header append Vary User-Agent env=!dont-vary
+    Header append Vary User-Agent env=!dont-vary
 
 </IfModule>
 
@@ -152,9 +162,15 @@
     #RewriteRule ^(.*)$ /mobiledirectoryhere/ [L,R=302]
 
 ############################################
+## redirects for production purposes
+
+    #RewriteRule ^tcd(?:/(.*))? tmfd/$1 [L,R=301]
+
+############################################
 ## always send 404 on missing files in these folders
 
     RewriteCond %{REQUEST_URI} !^/(media|skin|js)/
+    RewriteCond %{REQUEST_URI} !^/(server-status)
 
 ############################################
 ## never rewrite for existing files, directories and links
@@ -184,6 +200,7 @@
 ## Add default Expires header
 ## http://developer.yahoo.com/performance/rules.html#expires
 
+    ExpiresActive On
     ExpiresDefault "access plus 1 year"
 
 </IfModule>
Index: get.php
===================================================================
--- get.php	(revision 155730)
+++ get.php	(working copy)
@@ -32,7 +32,6 @@
         . 'target="">Find out</a> how to install</a> Magento using PHP-CGI as a work-around.</p></div>';
     exit;
 }
-$start = microtime(true);
 /**
  * Error reporting
  */
@@ -138,31 +137,31 @@
     checkResource($relativeFilename, $allowedResources);
 }
 
-if (0 !== stripos($pathInfo, $mediaDirectory . '/')) {
+if (0 !== stripos($pathInfo, $mediaDirectory . '/') || is_dir($filePath)) {
     sendNotFoundPage();
 }
 
-try {
+if (Mage::helper('core/file_storage_database')->checkDbUsage()) {
     $databaseFileSotrage = Mage::getModel('core/file_storage_database');
     $databaseFileSotrage->loadByFilename($relativeFilename);
-} catch (Exception $e) {
-}
-if ($databaseFileSotrage->getId()) {
-    $directory = dirname($filePath);
-    if (!is_dir($directory)) {
-        mkdir($directory, 0777, true);
-    }
 
-    $fp = fopen($filePath, 'w');
-    if (flock($fp, LOCK_EX | LOCK_NB)) {
-        ftruncate($fp, 0);
-        fwrite($fp, $databaseFileSotrage->getContent());
+    if ($databaseFileSotrage->getId()) {
+        $directory = dirname($filePath);
+        if (!is_dir($directory)) {
+            mkdir($directory, 0777, true);
+        }
+
+        $fp = fopen($filePath, 'w');
+        if (flock($fp, LOCK_EX | LOCK_NB)) {
+            ftruncate($fp, 0);
+            fwrite($fp, $databaseFileSotrage->getContent());
+        }
+        flock($fp, LOCK_UN);
+        fclose($fp);
+        sendFile($filePath);
     }
-    flock($fp, LOCK_UN);
-    fclose($fp);
 }
 
-sendFile($filePath);
 sendNotFoundPage();
 
 /**
@@ -186,6 +185,7 @@
     foreach ($allowedResources as $allowedResource) {
         if (0 === stripos($resource, $allowedResource)) {
             $isResourceAllowed = true;
+            break;
         }
     }
 
Index: index.php
===================================================================
--- index.php	(revision 155730)
+++ index.php	(working copy)
@@ -50,7 +50,7 @@
 }
 
 $mageFilename = MAGENTO_ROOT . '/app/Mage.php';
-$maintenanceFile = 'maintenance.flag';
+$maintenanceFile = '.htmaint';
 
 if (!file_exists($mageFilename)) {
     if (is_dir('downloader')) {
@@ -62,8 +62,13 @@
 }
 
 if (file_exists($maintenanceFile)) {
-    include_once dirname(__FILE__) . '/errors/503.php';
-    exit;
+    ob_start();
+    $maintenanceDevIps = include $maintenanceFile;
+    ob_end_clean();
+    if (!is_array($maintenanceDevIps) || !in_array($_SERVER['REMOTE_ADDR'], $maintenanceDevIps)) {
+        include_once dirname(__FILE__) . '/errors/503.php';
+        exit;
+    }
 }
 
 require_once $mageFilename;
